// Generator & datasource
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ===============================
// 1. Accounts
// ===============================
model Account {
  id         BigInt   @id @default(autoincrement())
  email      String   @unique
  password   String
  role       Role
  status     Status   @default(active)
  refreshToken String? 
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user          User?
  company       Company?
  notifications Notification[]
  admin_logs    AdminLog[]
}

enum Role {
  candidate
  recruiter
  admin
}

enum Status {
  active
  banned
  pending
}

// ===============================
// 2. Users
// ===============================
model User {
  id         BigInt    @id @default(autoincrement())
  account_id BigInt    @unique
  full_name  String
  phone      String?
  dob        DateTime?
  gender     Gender?
  address    String?
  avatar_url String?
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  account   Account    @relation(fields: [account_id], references: [id])
  candidate Candidate?
}

enum Gender {
  male
  female
  other
}

// ===============================
// 3. Candidates
// ===============================
model Candidate {
  id         BigInt   @id @default(autoincrement())
  user_id    BigInt   @unique
  education  String?
  experience String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user         User             @relation(fields: [user_id], references: [id])
  cvs          Cv[]
  applications Application[]
  saved_jobs   SavedJob[]
  skills       CandidateSkill[]
}

// ===============================
// 4. Companies
// ===============================
model Industry {
  id        BigInt    @id @default(autoincrement())
  name      String    @unique
  companies CompanyIndustry[]
}

model Company {
  id             BigInt             @id @default(autoincrement())
  account_id     BigInt             @unique
  name           String
  logo_url       String?
  logo_public_id String
  website        String?
  description    String?

  headquarters   String?            // üè¢ Th√†nh ph·ªë tr·ª• s·ªü ch√≠nh
  address        String?            // üìç ƒê·ªãa ch·ªâ chi ti·∫øt c·ªßa vƒÉn ph√≤ng ch√≠nh
  size           CompanySize?
  industry_info  CompanyIndustry[]  // üè≠ nhi·ªÅu lƒ©nh v·ª±c
  skills         CompanySkill[]     // üí° tech stack c·ªßa c√¥ng ty

  business_code           String?   @unique
  representative_name     String?
  representative_position String?
  license_file_url        String?
  founded_date            DateTime?

  contact_email  String?
  contact_phone  String?

  status         CompanyStatus @default(pending)
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt

  account    Account             @relation(fields: [account_id], references: [id])
  jobs       Job[]
  statistics RecruiterStatistic[]
}

model CompanySkill {
  id          BigInt @id @default(autoincrement())
  company_id  BigInt
  skill_id    BigInt

  company Company @relation(fields: [company_id], references: [id])
  skill   Skill   @relation(fields: [skill_id], references: [id])

  @@unique([company_id, skill_id])
}

model CompanyIndustry {
  id          BigInt   @id @default(autoincrement())
  company_id  BigInt
  industry_id BigInt

  company  Company  @relation(fields: [company_id], references: [id])
  industry Industry @relation(fields: [industry_id], references: [id])

  @@unique([company_id, industry_id])
}

enum CompanySize {
  small
  medium
  large
}

enum CompanyStatus {
  pending
  approved
  rejected
  hidden
}

// ===============================
// 5. Jobs
// ===============================
model Job {
  id                 BigInt           @id @default(autoincrement())
  company_id         BigInt
  category_id        BigInt
  title              String
  salary_min         Float
  salary_max         Float
  negotiable         Boolean          @default(false)

  // üó∫Ô∏è Th√¥ng tin ƒë·ªãa ƒëi·ªÉm
  location_city      String           // TP.HCM
  location_district  String?          // Qu·∫≠n 1
  location_ward      String?          // Ph∆∞·ªùng ƒêa Kao
  location_street    String?          // 29 Nguy·ªÖn ƒê√¨nh Chi·ªÉu
  location_full      String?          // Gh√©p t·ª± ƒë·ªông: "29 Nguy·ªÖn ƒê√¨nh Chi·ªÉu, Ph∆∞·ªùng ƒêa Kao, Qu·∫≠n 1, TP.HCM"
  latitude           Float?           // 10.7769
  longitude          Float?           // 106.7009

  // üíº H√¨nh th·ª©c & c·∫•p ƒë·ªô l√†m vi·ªác
  work_modes         Json            // V√≠ d·ª•: ["onsite", "remote"]
  experience_levels  Json            // V√≠ d·ª•: ["junior", "mid"]

  // üßæ Lo·∫°i vi·ªác & tr·∫°ng th√°i
  employment_type    EmploymentType
  status             JobStatus        @default(active)
  deadline           DateTime?
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt

  // Th√¥ng tin th·ªëng k√™
  number_of_openings Int               @default(1)   // S·ªë l∆∞·ª£ng c·∫ßn tuy·ªÉn
  views_count        Int               @default(0)   // T·ªïng l∆∞·ª£t xem job

  // üîó Quan h·ªá
  company      Company       @relation(fields: [company_id], references: [id])
  category     JobCategory?  @relation(fields: [category_id], references: [id])
  details      JobDetail?
  applications Application[]
  saved_jobs   SavedJob[]
  skills       JobSkill[]
}

model JobDetail {
  job_id       BigInt   @id
  description  String?  @db.LongText
  requirements String?  @db.LongText
  job          Job      @relation(fields: [job_id], references: [id])
}

model Skill {
  id         BigInt           @id @default(autoincrement())
  name       String           @unique
  jobs       JobSkill[]
  candidates CandidateSkill[]
  company_skills CompanySkill[]   // th√™m d√≤ng n√†y
}

model JobSkill {
  id       BigInt @id @default(autoincrement())
  job_id   BigInt
  skill_id BigInt

  job   Job   @relation(fields: [job_id], references: [id])
  skill Skill @relation(fields: [skill_id], references: [id])
}

enum EmploymentType {
  fulltime
  parttime
  intern
  contract
}

enum JobStatus {
  active
  hidden
  closed
  expired
}

enum WorkMode {
  onsite
  remote
  hybrid
}

enum ExperienceLevel {
  fresher
  junior
  mid
  senior
  lead
  intern
}

enum SkillLevel {
  beginner
  intermediate
  advanced
  expert
}

model CandidateSkill {
  id           BigInt      @id @default(autoincrement())
  candidate_id BigInt
  skill_id     BigInt
  level        SkillLevel?

  candidate Candidate @relation(fields: [candidate_id], references: [id])
  skill     Skill     @relation(fields: [skill_id], references: [id])
}

// ===============================
// 6. Job Categories
// ===============================
model JobCategory {
  id   BigInt @id @default(autoincrement())
  name String @unique
  jobs Job[]
}

// ===============================
// 7. CVs
// ===============================
model Cv {
  id           BigInt   @id @default(autoincrement())
  candidate_id BigInt
  title        String
  file_url     String?
  file_public_id  String?
  template_id  BigInt?
  content      Json?
  type         CvType   @default(ONLINE)
  is_deleted   Boolean  @default(false)  
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  candidate    Candidate     @relation(fields: [candidate_id], references: [id])
  template     CvTemplate?   @relation(fields: [template_id], references: [id])
  applications Application[]
}
enum CvType {
  FILE
  ONLINE
}


// ===============================
// 8. CV Templates
// ===============================
model CvTemplate {
  id          BigInt   @id @default(autoincrement())
  code        String   @unique
  name        String
  description String?
  preview_url String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  cvs Cv[]
}

// ===============================
// 9. Applications
// ===============================
model Application {
  id           BigInt            @id @default(autoincrement())
  job_id       BigInt
  candidate_id BigInt
  cv_id        BigInt
  status       ApplicationStatus @default(pending)
  applied_at   DateTime          @default(now())
  updated_at   DateTime          @updatedAt

  job       Job       @relation(fields: [job_id], references: [id])
  candidate Candidate @relation(fields: [candidate_id], references: [id])
  cv        Cv        @relation(fields: [cv_id], references: [id])
}

enum ApplicationStatus {
  pending
  accepted
  rejected
  withdrawn
}

// ===============================
// 10. Saved Jobs
// ===============================
model SavedJob {
  id           BigInt   @id @default(autoincrement())
  candidate_id BigInt
  job_id       BigInt
  saved_at     DateTime @default(now())
  updated_at   DateTime @updatedAt

  candidate Candidate @relation(fields: [candidate_id], references: [id])
  job       Job       @relation(fields: [job_id], references: [id])
}

// ===============================
// 11. Notifications
// ===============================
model Notification {
  id         BigInt           @id @default(autoincrement())
  account_id BigInt
  type       NotificationType
  message    String
  is_read    Boolean          @default(false)
  created_at DateTime         @default(now())
  updated_at DateTime         @updatedAt

  account Account @relation(fields: [account_id], references: [id])
}

enum NotificationType {
  system
  application
  company
}

// ===============================
// 12. Admin Logs
// ===============================
model AdminLog {
  id          BigInt     @id @default(autoincrement())
  admin_id    BigInt
  action      String
  target_type TargetType
  target_id   BigInt?
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  admin Account @relation(fields: [admin_id], references: [id])
}

enum TargetType {
  user
  company
  job
}

// ===============================
// 13. Site Statistics
// ===============================
model SiteStatistic {
  id         BigInt   @id @default(autoincrement())
  metric     String
  value      Int
  date       DateTime
  updated_at DateTime @updatedAt
}

// ===============================
// 14. Recruiter Statistics
// ===============================
model RecruiterStatistic {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  metric     String
  value      Int
  date       DateTime
  updated_at DateTime @updatedAt

  company Company @relation(fields: [company_id], references: [id])
}
